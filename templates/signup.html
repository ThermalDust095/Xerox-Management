<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swiftly</title>
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/login.css') }}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <header>
        <div id="pink-header"></div>
        <div id="second-header">
            <div id="btw-div"></div>
        </div>
        <div class="navbar">
            <div class="navbar-name border">
                <p>Swiftly</p>
            </div>

            <div class="navbar-logo border">
                <div class="logo"></div>
            </div>
        </div>
    </header>

    <section class="login-div">
        <div id="left-wave" data-aos="fade-right"></div>
        <div id="right-wave" data-aos="fade-left"></div>

        <div class="sign-container" data-aos="zoom-in">
            <h1>Sign Up</h1>
            <form id="signup-form">
              <input type="text" name="name" placeholder="Name" required /><br />
              <input type="email" name="email" placeholder="Email" required /><br />
              <input type="text" name="usn" placeholder="USN" required /><br />
              <input
                type="text"
                name="username"
                placeholder="Username"
                required
              /><br />
              <input
                type="password"
                name="password"
                placeholder="Password"
                required
              /><br />
              <input type="submit" value="Sign Up" />
            </form>
            <a href="#" class="forgot-password">Forgot Password?</a>
            <a href="/" class="create-account">Already have an account? Log in</a>
          </div>
    </section>


<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<script>
AOS.init();

function serializeFormToJson(form) {
  const formData = {};
  form.querySelectorAll('input').forEach(input => {
    formData[input.name] = input.value;
  });
  return formData;
}

async function handleFormSubmit(event) {
  event.preventDefault();

  const form = document.getElementById('signup-form');
  const formData = serializeFormToJson(form);

  console.log("Form Data:", formData);

  try {
    const res = await fetch("{{ url_for('create_acc') }}", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(formData)
    });

    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`);
    }

    const result = await res.json();   // assume you return JSON from Flask
    console.log("Server response:", result);

    if (result.status === "success") {
      window.location.href = "{{ url_for('login') }}";  // go to login page
    } else {
      alert("Signup failed: " + (result.message || "Unknown error"));
    }
  } catch (err) {
    console.error("Error:", err);
    alert("Something went wrong. Please try again.");
  }
}

document.getElementById("signup-form").addEventListener("submit", handleFormSubmit);
</script>


</body>
</html>